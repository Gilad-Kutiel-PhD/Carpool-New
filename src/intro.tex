Carpooling is the sharing of car journeys so that more than one
person travels in a car.  Knapen et al.~\cite{knapen2013estimating}
describe an automatic service to match commuting trips.  Users of the
service register their personal profile and a set of periodically
recurring trips, and the service advises registered candidates on how
to combine their commuting trips by carpooling.  The service acts in
two phases.

In the first phase, the service estimates the probability that a person $a$
traveling in person's $b$ car will be satisfied by the trip.
This is done based on personal information and feedback from users on past
rides.
The second phase is about finding a carpool matching
that maximizes the global (total expected) satisfaction.

The second phase can be modeled in terms of graph theory.  Given a
directed graph $G = (V, A)$, each vertex $v \in V$ corresponds to a
user of the service and an arc $(u, v)$ exists if the user
corresponding to vertex $u$ is willing to commute with the user
corresponding to vertex $v$.  A capacity function $ c:
V \rightarrow \N $ is defined according to the number of passengers
each user can drive if she was selected as a driver.  A weight
function $w : A \rightarrow \R $ defines the amount of satisfaction
$w(u, v)$ that user $u$ gains when riding with user $v$.
%
%Let $(G,c,w)$ be a carpool instance.
If $(u,v) \in A$ implies that $(v,u) \in A$ and $w(u,v) = w(v,u)$, we
call the instance \emph{undirected}.  If $w(v,u) = 1$, for every
$(v,u) \in A$, then we call the instance
\emph{unweighted}.  If $c(v) = \infty$, for every $v$, then we
call the instance \emph{uncapacitated}.

Given a directed graph $G$ and a subset $M \subseteq A$, define
$\din[M](v) \eqdf \abs{\set{u :(u,v) \in M}}$ and
$\dout[M](v) \eqdf \abs{\set{u :(v,u) \in M}}$.
%
A feasible \emph{carpool matching} is a subset of arcs, $M \subseteq
A$, such that every $v \in V$ satisfies:
\begin{inparaenum}[(i)]
\item $\din[M](v) \cdot \dout[M](v) = 0$,
\item $\din[M](v) \leq c(v)$, and 
\item $\dout[M](v) \leq 1$.
\end{inparaenum}
A vertex $v$ for which $\dout[M](v) = 1$ is a \emph{passenger}, and a
vertex for which $\dout[M](v) = 0$ is a driver who has $\din[M](v)$
passengers.  In the \carpool problem the goal is to find a matching
$M$ of maximum total weight, namely to maximize
$w(M) \eqdf \sum_{(v,u) \in M} w(v,u)$.  In other words, the \carpool
problem is about finding a set of (directed toward the center) vertex
disjoint stars that maximizes the total weight of the arcs.
Figure~\ref{fig:carpool} is an example of the \carpool problem.

\begin{figure}
\centering
\input{fig-carpool}
\caption[]{
\label{fig:carpool}
A carpool matching example: 
\subref{carpool:input}
a directed graph with capacities on the vertices and weights on the arcs. 
\subref{carpool:output}
a feasible matching with total weight of 26.
$P$ is the set of blue vertices, and $D$ is the set of red, dashed vertices. 
}
\end{figure}  

In this paper we also consider an extension of \carpool, called \gcp,
in which each vertex represents a group of passengers, and  
each group might have a different size. 
Formally, each vertex $u \in V$ has a size $s(u) \in \N$, 
and the constraint $\din[M](v) \leq c(v)$ is replaced with the constraint
$\sum_{u:(u,v) \in M} s(u) \leq c(v)$.
%
Notice that \textsc{Knapsack} is the special case, where only
arcs directed at a single vertex have non-zero (integral) weights.

%%%%%

\subparagraph{Related work.}
%
Hartman et al.~\cite{hartman2013optimal} proved that the \carpool
problem is NP-hard, and that the problem
remains NP-hard even for a binary weight function when the capacity
function $c(v) \leq 2$ for every vertex in $V$.  It is also worth
mentioning, that in the undirected, uncapacitated, unweighted variant
of the problem, the set of drivers in an optimal solution form a
minimum dominating set (see Section~\ref{sec:hardness}).  When the set
of drivers is known in advanced, however, the problem becomes
tractable and can be solved using a reduction to a flow network
problem.

Agatz et al.~\cite{agatz2012optimization} outlined the optimization
challenges that arise when developing technology to support
ride-sharing and survey the related operations research models in the
academic literature.  Hartman et al.~\cite{hartman2014theory} designed
several heuristic algorithms for the \carpool problem and compared
their performance on real data.  Other heuristic algorithms were
developed as well~\cite{knapen2014exploiting}.  Arkin et
al.~\cite{arkin2004approximations} considered other variants of
capacitated star packing where a capacity vector is given as part of
the input and capacities need to be assigned to vertices.

Nguyen et al.~\cite{nguyen2008approximating} considered
the \textsc{spanning star forest} problem (the undirected,
uncapacitated, unweighted variant of the problem).  They proved the
following results:
\begin{inparaenum}[(i)]
\item there is a polynomial-time approximation scheme for planner graphs;
\item there is a polynomial-time $\frac{3}{5}$-approximation algorithm for graphs;
\item there is a polynomial-time $\frac{1}{2}$-approximation algorithm for weighted graphs.
\end{inparaenum}
They also showed how to apply the spanning star forest model to
aligning multiple genomic sequences over a tandem duplication region.
Chen et al.~\cite{chen2007improved} improved the approximation ratio
to 0.71, and also showed that the problem can not be approximated to
within a factor of $\frac{31}{32} + \epsilon$ for any $\epsilon > 0$
under the assumption that $\text{P} \neq \text{NP}$.  It is not clear,
however, if any of the technique used to address the
\textsc{spanning star forest} problem can be generalized to approximate the
directed capacitated variant.

Kutiel~\cite{kutiel2016} presented a $\frac{1}{3}$-approximation
algorithm for the problem and $\frac{1}{2}$-approximation algorithm for the
unweighted variant of the problem.

Bar-Noy et al.~\cite{bar2015improved} considered the problem of partition a
graph into disjoint paths of length 2.
This problem is a special case of the undirected carpool matching
where all capacities are exactly 2.
They show a $.5833$, and $\frac{3}{4}$-approximation algorithms for the weighted
and unweighted variants of the problem respectively.

For the general set packing problem, the best known approximation algorithm is
due to Chandra et al.~\cite{chandra2001greedy} and it admits a 
$\frac{2(k +1)}{3}$ approximation ratio where $k$ is the size of the sets.

%%%%%

\subparagraph{Our contribution.}
%
In Section~\ref{sec:sub} we show that the \carpool can be formulated as
unconstrained submodular maximization problem, thus it has a
$\frac{1}{2}$-approximation algorithm due to~\cite{BFNS15}.  

In Section~\ref{sec:local} we consider the unweighted variant of the
problem.  We provide a $(\frac{2\cmax}{\cmax+1} + \eps)$-approximation
algorithm, for any $\eps>0$, where $\cmax$ is the maximum capacity.
We also show that \carpool is APX-hard even if $\cmax \leq 3$.
%
In Section~\ref{sec:group} we consider \gcp.  
We first show that the unconstrained submodular maximization formulation for
the \carpool does not follow for the \gcp.
We show, however, that this problem still admits
a $(\frac{1}{2} -\varepsilon)$-approximation algorithm, and argue that the local
search algorithm generalizes to \gcp as well.
